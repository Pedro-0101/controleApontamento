<div class="multi-select-container">
  <div class="multi-select-header" (click)="toggleDropdown()" [class.disabled]="disabled()">
    <div class="selected-count">
      @if (selectedValues().length === 0) {
        <span class="placeholder">{{ placeholder() }}</span>
      } @else {
        <span class="count-badge">{{ selectedValues().length }} selecionado(s)</span>
      }
    </div>
    <lucide-icon [name]="isDropdownOpen() ? 'chevron-up' : 'chevron-down'" [size]="16"></lucide-icon>
  </div>

  @if (isDropdownOpen()) {
    <div class="multi-select-dropdown">
      <div class="dropdown-search">
        <lucide-icon name="search" [size]="14" class="search-icon"></lucide-icon>
        <label for="ddSearch" class="sr-only">{{ searchPlaceholder() }}</label>
        <input
          type="text"
          id="ddSearch"
          name="ddSearch"
          class="search-input"
          [placeholder]="searchPlaceholder()"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
          (click)="$event.stopPropagation()"
        >
      </div>

      <div class="dropdown-options">
        <label class="option-item select-all" (click)="$event.stopPropagation()">
          <input
            type="checkbox"
            [checked]="isAllSelected()"
            (change)="toggleSelectAll()"
          >
          <span>Selecionar Todos</span>
        </label>

        @for (option of filteredOptions(); track getValue(option)) {
          <label class="option-item" [class.selected]="isOptionSelected(getValue(option))" (click)="$event.stopPropagation()">
            <input
              type="checkbox"
              [checked]="isOptionSelected(getValue(option))"
              (change)="toggleOption(getValue(option))"
            >
            <div class="option-info">
              <span class="option-name">{{ getLabel(option) }}</span>
              @if (getSubLabel(option)) {
                <span class="option-matricula">{{ getSubLabel(option) }}</span>
              }
            </div>
          </label>
        } @empty {
          <div class="empty-options">Nenhum resultado encontrado</div>
        }
      </div>
    </div>
  }
</div>

@if (isDropdownOpen()) {
  <div class="dropdown-overlay" (click)="toggleDropdown()"></div>
}
