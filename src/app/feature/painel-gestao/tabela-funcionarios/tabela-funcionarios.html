<div class="table-container">
  
  <!-- Search and controls will use global styles -->
  <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-xl); background: white; border-bottom: 1px solid var(--color-gray-200);">
    <div style="position: relative; flex: 1; max-width: 400px;">
      <input 
        type="text" 
        placeholder="Pesquisar por nome, matrícula ou empresa..." 
        (input)="onSearch($event)"
        class="input-text"
        style="width: 100%; padding-left: 40px;"
      >
    </div>

    <div style="display: flex; align-items: center; gap: var(--spacing-lg);">
      <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
        <label style="margin: 0; font-size: var(--font-size-sm); color: var(--color-gray-600);">Itens por página:</label>
        <select (change)="onItemsPerPageChange($event)" class="input-select" style="min-width: 80px;">
          @for (option of itemsPerPageOptions; track option) {
            <option [value]="option" [selected]="option === itemsPerPage()">{{ option }}</option>
          }
        </select>
      </div>

      <button class="btn-export" (click)="abrirModalExportacao()">
        <lucide-icon name="download" [size]="18"></lucide-icon>
        Exportar
      </button>
    </div>
  </div>

  @if (exibindoModalExportacao()) {
    <app-modal-exportacao 
      [data]="_sortedMarcacoes()" 
      (close)="fecharModalExportacao()"
    ></app-modal-exportacao>
  }

  @if (selectedRecord()) {
    <app-modal-detalhes-marcacao
      [record]="selectedRecord()!"
      (close)="fecharDetalhes()"
      (updated)="recarregarDados()"
    ></app-modal-detalhes-marcacao>
  }


  @if (_isLoadingMarcacoesPainel()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando marcações...</p>
    </div>
  } @else {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th (click)="onSort('matricula')" class="sortable col-matricula">
              Matrícula
              @if(sortColumn() === 'matricula') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
            </th>
            <th (click)="onSort('empresa')" class="sortable col-empresa">
              Empresa
              @if(sortColumn() === 'empresa') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
            </th>
            <th (click)="onSort('nome')" class="sortable col-nome">
              Nome
              @if(sortColumn() === 'nome') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
            </th>
            <th (click)="onSort('data')" class="sortable col-data">
              Data
              @if(sortColumn() === 'data') { <span>{{ sortDirection() === 'asc' ? '▲' : '▼' }}</span> }
            </th>
            <th class="col-dia-semana">Dia Semana</th>
            <th class="col-hora">Hora</th>
            <th class="col-total-horas">Total Horas</th>
            <th class="col-status">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (item of _paginatedMarcacoes(); track item.matricula + '_' + item.data) {
            <tr app-linha-tabela-marcacoes [marcacao]="item" (openDetails)="abrirDetalhes($event)" class="clickable-row"></tr>
          } @empty {
            <tr>
              <td colspan="7" style="text-align: center">Nenhuma marcação encontrada.</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-xl); background: white; border-top: 1px solid var(--color-gray-200);">
      <span style="color: var(--color-gray-500); font-size: var(--font-size-sm);">
        Página {{ currentPage() }} de {{ _totalPages() }} (Total: {{ _totalItems() }} itens)
      </span>
      <div style="display: flex; gap: var(--spacing-sm);">
        <button (click)="prevPage()" [disabled]="currentPage() === 1" class="btn btn-outline" style="min-width: 100px;">Anterior</button>
        <button (click)="nextPage()" [disabled]="currentPage() === _totalPages()" class="btn btn-outline" style="min-width: 100px;">Próximo</button>
      </div>
    </div>
  }
</div>
