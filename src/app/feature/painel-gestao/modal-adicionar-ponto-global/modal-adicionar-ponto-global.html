<div class="modal-overlay" (click)="close.emit()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Novo Ponto Manual</h3>
      <button class="btn-close" (click)="close.emit()">
        <lucide-icon name="x" [size]="20"></lucide-icon>
      </button>
    </div>

    <div class="modal-body">
      <!-- Funcionário -->
      <div class="form-group">
        <label>Funcionários</label>
        <app-multi-select-dropdown
          [options]="employees()"
          [initialValue]="selectedMatriculas()"
          placeholder="Selecione os funcionários..."
          searchPlaceholder="Pesquisar por nome ou matrícula..."
          (selectionChange)="onSelectionChange($event)"
        ></app-multi-select-dropdown>
      </div>

      <div style="display: flex; gap: 1rem;">
        <!-- Data -->
        <div class="form-group" style="flex: 1;">
          <label for="pontoData">Data</label>
          <input 
            type="date" 
            id="pontoData" 
            class="input-text" 
            [(ngModel)]="selectedDate"
          />
        </div>

        <!-- Hora -->
        <div class="form-group" style="flex: 1;">
          <label for="pontoHora">Hora</label>
          <input 
            type="time" 
            id="pontoHora" 
            class="input-text" 
            [(ngModel)]="selectedTime"
          />
        </div>
      </div>

      <!-- Alerta de Dia Lógico -->
      @if (isLogicalDayShift()) {
        <div class="logical-day-warning">
          <lucide-icon name="alert-triangle" [size]="16"></lucide-icon>
          <span>Atenção: Por ser antes das 05h, este ponto será considerado como término da jornada anterior. O comentário será registrado na data anterior.</span>
        </div>
      }

      <div class="form-group">
        <label for="comentario">Comentário</label>
        <textarea 
          id="comentario" 
          class="input-text" 
          rows="3" 
          placeholder="Descreva o motivo deste apontamento..." 
          [(ngModel)]="comentario"
        ></textarea>
        <small class="form-hint" [class.error]="!comentario().trim()">* O comentário é obrigatório para auditoria.</small>
      </div>
    </div>

    <div class="modal-footer">
      <app-button variant="outline" (onClick)="close.emit()">Cancelar</app-button>
      <app-button 
        icon="save"
        [loading]="isSaving()" 
        [disabled]="!isFormValid()"
        (onClick)="salvar()"
      >
        Salvar Ponto
      </app-button>
    </div>
  </div>
</div>
