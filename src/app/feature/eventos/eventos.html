<div class="eventos-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Gerenciamento de Eventos</h1>
      <p>Lance e gerencie afastamentos, férias e outros períodos para os colaboradores.</p>
    </div>
    <button class="btn btn-primary" (click)="openAddForm()">
      <lucide-icon name="plus" [size]="18"></lucide-icon>
      Lançar Evento
    </button>
  </div>

  @if (showForm()) {
    <div class="form-card">
      <div class="form-header">
        <h3>{{ editingId() ? 'Editar Evento' : 'Novo Evento por Período' }}</h3>
        <button class="btn-icon" (click)="showForm.set(false)">
          <lucide-icon name="x" [size]="20"></lucide-icon>
        </button>
      </div>
      
      <div class="form-grid">
        <div class="form-item">
          <label>Colaborador(es)</label>
          <app-multi-select-dropdown
            [options]="employees()"
            [initialValue]="formData.matriculas"
            placeholder="Selecione um ou mais colaboradores..."
            (selectionChange)="formData.matriculas = $event"
            [disabled]="!!editingId()"
          ></app-multi-select-dropdown>
        </div>
        
        <div class="form-item">
          <label>Tipo de Evento</label>
          <select [(ngModel)]="formData.tipoEvento" class="form-input">
            <option value="">Selecione o tipo...</option>
            @for (status of statusPeriodo; track status) {
              <option [value]="status">{{ status }}</option>
            }
          </select>
        </div>

        <div class="form-item">
          <label>Data Início</label>
          <input type="date" [(ngModel)]="formData.dataInicio" class="form-input">
        </div>

        <div class="form-item">
          <label>Data Fim</label>
          <input type="date" [(ngModel)]="formData.dataFim" class="form-input">
        </div>
      </div>

      <div class="form-actions">
        <button class="btn btn-outline" (click)="showForm.set(false)">Cancelar</button>
        <button class="btn btn-primary" (click)="saveEvent()" [disabled]="isSaving()">
          @if (isSaving()) {
            <div class="btn-spinner"></div>
          }
          {{ editingId() ? 'Atualizar Evento' : 'Salvar Evento' }}
        </button>
      </div>
    </div>
  }

  <div class="table-card">
    <div class="table-responsive">
      <table class="eventos-table">
        <thead>
          <tr>
            <th>Funcionário</th>
            <th>Evento</th>
            <th>Início</th>
            <th>Fim</th>
            <th>Lançado por</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          @for (event of events(); track event.id) {
            <tr>
              <td>
                <div class="emp-info">
                  <span class="emp-name">{{ event.nome_funcionario }}</span>
                  <span class="emp-mat">#{{ event.matricula_funcionario }}</span>
                </div>
              </td>
              <td>
                <span class="badge badge-event">{{ event.tipo_evento }}</span>
              </td>
              <td>{{ formatData(event.data_inicio) }}</td>
              <td>{{ formatData(event.data_fim) }}</td>
              <td>{{ event.criado_por }}</td>
              <td class="col-actions">
                <button class="btn-icon" (click)="editEvent(event)" title="Editar">
                  <lucide-icon name="edit-3" [size]="18"></lucide-icon>
                </button>
                <button class="btn-icon btn-danger" (click)="deleteEvent(event.id)" title="Excluir">
                  <lucide-icon name="trash-2" [size]="18"></lucide-icon>
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="6" class="empty-state">
                <div class="empty-content">
                  <lucide-icon name="calendar" [size]="48"></lucide-icon>
                  <p>Nenhum evento de período cadastrado.</p>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>
