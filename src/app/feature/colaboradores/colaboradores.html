<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <h1>
        <lucide-icon name="users" [size]="28"></lucide-icon>
        Colaboradores
      </h1>
      <p class="subtitle">Gerenciar funcionários da empresa</p>
    </div>
    <div class="header-actions">
      @if (selectedEmployeeIds().length > 0) {
        <app-button variant="outline" size="sm" icon="printer" (onClick)="batchGenerateCards()">
          Gerar Cartões ({{ selectedEmployeeIds().length }})
        </app-button>
        <app-button variant="danger" size="sm" icon="shield-alert" (onClick)="batchDeactivate()">
          Desativar Selecionados ({{ selectedEmployeeIds().length }})
        </app-button>
      }
      <app-button size="sm" icon="plus" (onClick)="openCreateModal()">
        Adicionar Colaborador
      </app-button>
    </div>
  </div>

  @if(isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Carregando colaboradores...</p>
    </div>
  } @else {
    <div class="table-container">
      <div class="filters-layout">
        <app-search-filter
          class="flex-1"
          searchPlaceholder="Pesquisar por nome ou matrícula..."
          filterLabel="Status:"
          [filterOptions]="filterOptions()"
          (searchChange)="onSearchChange($event)"
          (filterChange)="onFilterChange($event)"
        ></app-search-filter>

        <div class="company-filter-box">
          <app-multi-select-dropdown
            [options]="companyOptions()"
            [placeholder]="'Selecione as empresas...'"
            [searchPlaceholder]="'Buscar empresas...'"
            (selectionChange)="onCompanySelectionChange($event)"
          ></app-multi-select-dropdown>
        </div>
      </div>

      <table class="data-table">
        <thead>
          <tr>
            <th class="checkbox-column">
              <input type="checkbox" [checked]="isAllSelected()" (change)="toggleAll()">
            </th>
            <th>Nome</th>
            <th>Matrícula</th>
            <th>Empresa</th>
            <th>Status</th>
            <th class="actions-column">Ações</th>
          </tr>
        </thead>
        <tbody>
          @for (employee of paginatedEmployees(); track employee.id) {
            <tr>
              <td>
                <input type="checkbox" [checked]="selectedEmployeeIds().includes(employee.id)" (change)="toggleEmployee(employee.id)">
              </td>
              <td class="employee-name">
                <lucide-icon name="user" [size]="16"></lucide-icon>
                {{ employee.nome }}
              </td>
              <td>{{ employee.matricula }}</td>
              <td>{{ employee.empresa }}</td>
              <td>
                <span class="badge" [class]="getStatusClass(employee.ativo)">
                  {{ getStatusLabel(employee.ativo) }}
                </span>
              </td>
              <td class="actions-cell">
                <button class="btn-icon" (click)="generateCard(employee)" title="Gerar Cartão">
                  <lucide-icon name="printer" [size]="16"></lucide-icon>
                </button>
                <button class="btn-icon" (click)="openEditModal(employee)" title="Editar">
                  <lucide-icon name="edit" [size]="16"></lucide-icon>
                </button>
                <button class="btn-icon btn-danger" (click)="deleteEmployee(employee)" title="Excluir">
                  <lucide-icon name="trash-2" [size]="16"></lucide-icon>
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="5" class="empty-state">
                <lucide-icon name="users" [size]="48"></lucide-icon>
                <p>Nenhum colaborador encontrado</p>
                <app-button size="sm" (onClick)="openCreateModal()">
                  Adicionar Primeiro Colaborador
                </app-button>
              </td>
            </tr>
          }
        </tbody>
      </table>

      <app-pagination
        [totalItems]="filteredEmployees().length"
        [itemsPerPage]="itemsPerPage()"
        [currentPage]="currentPage()"
        (pageChange)="onPageChange($event)"
        (itemsPerPageChange)="onItemsPerPageChange($event)"
      ></app-pagination>
    </div>
  }

  @if(showModal()) {
    <app-modal-colaborador
      [mode]="modalMode()"
      [employee]="selectedEmployee()"
      (close)="closeModal()"
      (save)="handleSave()"
    ></app-modal-colaborador>
  }
</div>
